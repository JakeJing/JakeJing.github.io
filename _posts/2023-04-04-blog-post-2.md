---
title: 'Tesing blog'
date: 2023-04-04
permalink: /posts/2023/04/blog-post-2/
tags:
  - Bayesian MCMC
  - bayes.js
  - Statistical Distributions
  - AmwgSampler
  - plotly
---

This blog heavily relies on Bååth’s library and his implementations. I appreciate his efforts to build a web app for Bayesian data analysis in JavaScript. Here I made some small adjustments by **(1) including the data generating process by using**[ **d3.js**](https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js)**; (2) simultaneously updating the posterior distributions with the true parameters indicated by red vertical lines; (3) adding buttons to display messages and warnings**. These changes are purely based on my personal tastes since I want to simulate data with valid parameters from a probabilistic distribution and check the performance of the posterior estimates against the original parameter values. With some help from ChatGPT, I implemented the web app and deployed it inside my personal webpage powered by Jekyll. Here is the web app for Bayesian MCMC for Normal distributions. If you prefer a standalone version, pls check[ this page](https://jakejing.github.io/bayes_mcmc_plot/).


{% include base_path %}

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title _msttexthash="3419442" _msthash="0">
    bayes.js: A Small Library for Doing MCMC in the Browser | Rasmus Bååth's
    blog
  </title>
  <meta property="og:site_name" content="Rasmus Bååth&#39;s Blog" />
  <meta
    property="og:title"
    content="bayes.js: A Small Library for Doing MCMC in the Browser"
  />
  <meta property="og:type" content="article" />
  <meta
    property="og:url"
    content="https://sumsar.net/blog/2015/12/bayes-js-a-small-library-for-doing-mcmc-in-the-browser/"
  />
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
    crossorigin="anonymous"
  ></script>
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    onload="renderMathInElement(document.body);"
  ></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      renderMathInElement(document.body, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false },
        ],
      });
    });
  </script>
  <script
    type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"
  ></script>
  <script
    type="text/javascript"
    src="https://cdn.plot.ly/plotly-latest.min.js"
  ></script>
  <style></style>
  <script
    type="text/javascript"
    src="https://rawgit.com/rasmusab/bayes.js/master/mcmc.js"
  ></script>
  <script
    type="text/javascript"
    src="https://rawgit.com/rasmusab/bayes.js/master/distributions.js"
  ></script>
</head>
<p>
  <button onclick="sample_loop()" _msttexthash="235235" _msthash="14">
    Start sampling
  </button>
  <button onclick="stop_sample_loop()" _msttexthash="857311" _msthash="15">
    Stop sampling and plot histograms
  </button>
  <button onclick="clear_samples()" _msttexthash="205764" _msthash="16">
    Clear samples
  </button>
</p>
<div id="mcmc_plots_div"></div>
<script>
  var data = [183, 192, 182, 183, 177, 185, 188, 188, 182, 185];

  var params = {
    mu: { type: "real" },
    sigma: { type: "real", lower: 0 },
  };

  var log_post = function (state, data) {
    var log_post = 0;
    // Priors
    log_post += ld.norm(state.mu, 0, 100);
    log_post += ld.unif(state.sigma, 0, 100);
    // Likelihood
    for (var i = 0; i < data.length; i++) {
      log_post += ld.norm(data[i], state.mu, state.sigma);
    }
    return log_post;
  };
  var sampler = new mcmc.AmwgSampler(params, log_post, data);
  sampler.burn(500);
  var samples = sampler.sample(1);

  var plot_margins = { l: 40, r: 10, b: 40, t: 40, pad: 4 };

  var param_names = Object.keys(params);
  var params_to_plot = Object.keys(params);

  for (var i = 0; i < params_to_plot.length; i++) {
    var param = params_to_plot[i];
    $("div#mcmc_plots_div").append(
      "<div>" +
        '<div id = "' +
        param +
        "_trace_div" +
        '" style="width:350px;height:250px;display: inline-block;"></div>' +
        '<div id = "' +
        param +
        "_hist_div" +
        '" style="width:350px;height:250px;display: inline-block;"></div>' +
        "</div>"
    );
    Plotly.plot($("div#" + param + "_trace_div")[0], [{ y: samples[param] }], {
      margin: plot_margins,
      title: "Traceplot of " + param,
    });
    Plotly.plot(
      $("div#" + param + "_hist_div")[0],
      [{ x: samples[param], type: "histogram" }],
      { margin: plot_margins, title: "Posterior of " + param }
    );
  }

  var update_trace_plots = function () {
    for (var i = 0; i < params_to_plot.length; i++) {
      var param = params_to_plot[i];
      Plotly.restyle($("div#" + param + "_trace_div")[0], {
        y: [samples[param]],
      });
    }
  };

  var update_histograms = function () {
    for (var i = 0; i < params_to_plot.length; i++) {
      var param = params_to_plot[i];
      Plotly.restyle($("div#" + param + "_hist_div")[0], {
        x: [samples[param]],
        xbins: {},
      });
    }
  };

  var clear_samples = function () {
    samples = sampler.sample(1);
    update_trace_plots();
    update_histograms();
  };

  var sample_loop_timeout_id;
  var sample_loop = function () {
    var n_samples = Math.min(
      250,
      Math.ceil(samples[param_names[0]].length / 10)
    );
    var more_samples = sampler.sample(n_samples);
    for (var i = 0; i < param_names.length; i++) {
      var param = param_names[i];
      Array.prototype.push.apply(samples[param], more_samples[param]);
    }
    update_trace_plots();
    sample_loop_timeout_id = setTimeout(sample_loop, 1);
  };

  var stop_sample_loop = function () {
    clearTimeout(sample_loop_timeout_id);
    update_trace_plots();
    update_histograms();
  };
  clear_samples();
</script>
