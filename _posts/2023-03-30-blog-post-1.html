<!DOCTYPE html>
<!-- saved from url=(0091)https://www.sumsar.net/blog/2015/12/bayes-js-a-small-library-for-doing-mcmc-in-the-browser/ -->
<html lang="en-us">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title _msttexthash="3419442" _msthash="0">
      bayes.js: A Small Library for Doing MCMC in the Browser | Rasmus Bååth's
      blog
    </title>
    <meta property="og:site_name" content="Rasmus Bååth&#39;s Blog" />
    <meta
      property="og:title"
      content="bayes.js: A Small Library for Doing MCMC in the Browser"
    />
    <meta property="og:type" content="article" />
    <meta
      property="og:url"
      content="https://sumsar.net/blog/2015/12/bayes-js-a-small-library-for-doing-mcmc-in-the-browser/"
    />
    <meta
      property="og:image"
      content="https://sumsar.net/images/open-graph-placeholder.png"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
      integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
      integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
      onload="renderMathInElement(document.body);"
    ></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
          ],
        });
      });
    </script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.plot.ly/plotly-latest.min.js"
    ></script>
    <style></style>
    <script
      type="text/javascript"
      src="https://rawgit.com/rasmusab/bayes.js/master/mcmc.js"
    ></script>
    <script
      type="text/javascript"
      src="https://rawgit.com/rasmusab/bayes.js/master/distributions.js"
    ></script>
  </head>

  <body
    class="vsc-initialized"
    data-new-gr-c-s-check-loaded="14.1028.0"
    data-gr-ext-installed=""
  >
    <header>
      <h1>
        <a href="https://www.sumsar.net/" _msttexthash="312546" _msthash="1"
          >Publishable Stuff</a
        >
      </h1>
      <h2 _msttexthash="371163" _msthash="2">Rasmus Bååth's Blog</h2>
      <hr />
    </header>

    <div class="article-meta">
      <h1>
        <span class="title" _msttexthash="1761240" _msthash="9"
          >bayes.js: A Small Library for Doing MCMC in the Browser</span
        >
      </h1>
      <h2 class="date" _msttexthash="73021" _msthash="10">2015-12-31</h2>
    </div>
    <p>
      <button onclick="sample_loop()" _msttexthash="235235" _msthash="14">
        Start sampling
      </button>
      <button onclick="stop_sample_loop()" _msttexthash="857311" _msthash="15">
        Stop sampling and plot histograms
      </button>
      <button onclick="clear_samples()" _msttexthash="205764" _msthash="16">
        Clear samples
      </button>
    </p>
    <div id="mcmc_plots_div"></div>
    <script>
      var clear_samples;
      var sample_loop;
      var stop_sample_loop;
      var heights = [183, 192, 182, 177, 185, 188, 188, 182, 185];

      var params = {
        mu: { type: "real" },
        sigma: { type: "real", lower: 0 },
      };

      var log_post = function (state, heights) {
        var log_post = 0;
        // Priors (here sloppy and vague...)
        log_post += ld.norm(state.mu, 0, 1000);
        log_post += ld.unif(state.sigma, 0, 1000);
        // Likelihood
        for (var i = 0; i < heights.length; i++) {
          log_post += ld.norm(heights[i], state.mu, state.sigma);
        }
        return log_post;
      };

      // Initializing the sampler and generate a sample of size 1000
      var sampler = new mcmc.AmwgSampler(params, log_post, heights);
      sampler.burn(1000);
      var samples = sampler.sample(1000);

      // Setting up the plots
      var plot_margins = {
        l: 40,
        r: 10,
        b: 40,
        t: 40,
        pad: 4,
      };

      var param_names = Object.keys(params);
      var params_to_plot = Object.keys(params);

      for (var i = 0; i < params_to_plot.length; i++) {
        var param = params_to_plot[i];
        $("div#mcmc_plots_div").append(
          "<div>" +
            '<div id = "' +
            param +
            "_trace_div" +
            '" style="width:300px;height:200px;display: inline-block;"></div>' +
            '<div id = "' +
            param +
            "_hist_div" +
            '" style="width:300px;height:200px;display: inline-block;"></div>' +
            "</div>"
        );
        Plotly.plot(
          $("div#" + param + "_trace_div")[0],
          [{ y: samples[param] }],
          {
            margin: plot_margins,
            title: "Traceplot of " + param,
          }
        );
        Plotly.plot(
          $("div#" + param + "_hist_div")[0],
          [{ x: samples[param], type: "histogram" }],
          {
            margin: plot_margins,
            title: "Posterior of " + param,
          }
        );
      }

      var update_trace_plots = function () {
        for (var i = 0; i < params_to_plot.length; i++) {
          var param = params_to_plot[i];
          Plotly.restyle($("div#" + param + "_trace_div")[0], {
            y: [samples[param]],
          });
        }
      };

      var update_histograms = function () {
        for (var i = 0; i < params_to_plot.length; i++) {
          var param = params_to_plot[i];
          Plotly.restyle($("div#" + param + "_hist_div")[0], {
            x: [samples[param]],
          });
        }
      };

      // Below are the functions that enables starting and stopping the
      // sampling using the buttons

      clear_samples = function () {
        samples = sampler.sample(1);
        update_trace_plots();
        update_histograms();
      };

      var sample_loop_timeout_id;
      sample_loop = function () {
        var n_samples = Math.min(
          100,
          Math.ceil(samples[param_names[0]].length / 10)
        );
        var more_samples = sampler.sample(n_samples);
        for (var i = 0; i < param_names.length; i++) {
          var param = param_names[i];
          Array.prototype.push.apply(samples[param], more_samples[param]);
        }
        update_trace_plots();
        sample_loop_timeout_id = setTimeout(sample_loop, 1);
      };

      stop_sample_loop = function () {
        clearTimeout(sample_loop_timeout_id);
        update_trace_plots();
        update_histograms();
      };
      <!-- clear_samples(); -->
    </script>
  </body>
</html>
