---
title: 'Simulating and Modeling Statistical Distributions via bayes.js'
date: 2023-04-03
permalink: /posts/2023/04/blog-post-1/
tags:
  - Bayesian MCMC
  - bayes.js
  - Statistical Distributions
  - AmwgSampler
  - plotly
---

I have been thinking about building a web app for simulating data with given parameters and recovering the parameters with Bayesian MCMC samplers in JavaScript. This web app can not only make the steps more transparent, but also help us understand the magic of the Bayesian MCMC approach. More importantly, I have benefited from this simulation-based way of thinking, so I would like to promote it in my blog.

I looked for some off-the-shelf software online and found a JS library[ bayes.js](https://github.com/rasmusab/bayes.js) developed by Rasmus Bååth. He also wrote a[ blog](https://www.sumsar.net/blog/2015/12/bayes-js-a-small-library-for-doing-mcmc-in-the-browser/) to introduce the library. I strongly recommend you first to read his blog to get some key ideas behind it. The library includes an adaptive MCMC sampler (AmwgSampler) in[ mcmc.js](https://raw.githubusercontent.com/rasmusab/bayes.js/master/mcmc.js) and some common probability distributions in[ distributions.js](https://raw.githubusercontent.com/rasmusab/bayes.js/master/distributions.js). There are also some examples, e.g., you can use bayes.js to fit a Normal distribution and plot the posterior distributions of parameters via[ plotly.js](https://cdn.plot.ly/plotly-latest.min.js).

This blog heavily relies on Bååth’s library and his implementations. I appreciate his efforts to build a web app for Bayesian data analysis in JavaScript. Here I made some small adjustments by **(1) including the data generating process by using**[ **d3.js**](https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js)**; (2) simultaneously updating the posterior distributions with the true parameters indicated by red vertical lines; (3) adding buttons to display messages and warnings**. These changes are purely based on my personal tastes since I want to simulate data with valid parameters from a probabilistic distribution and check the performance of the posterior estimates against the original parameter values. With some help from ChatGPT, I implemented the web app and deployed it inside my personal webpage powered by Jekyll. Here is the web app for Bayesian MCMC for Normal distributions. If you prefer a standalone version, pls check[ this page](https://jakejing.github.io/bayes_mcmc_plot/).

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Normal Distribution Simulator</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
      #histogram {
        width: 600px;
        height: 400px;
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Normal Distribution Simulator</h1>
    <label for="mu">Mean (mu):</label>
    <input type="number" id="mu" name="mu" step="0.01" value="0" />
    <br />
    <label for="sd">Standard Deviation (sd):</label>
    <input type="number" id="sd" name="sd" step="0.01" value="1" />
    <br />
    <label for="n">Number of Data Points (n):</label>
    <input type="number" id="n" name="n" value="100" />
    <br />
    <button id="simulate">Simulate</button>
    <button id="plot">Plot</button>
    <div id="message"></div>
    <div id="histogram"></div>
    <script>
    function normal(mu, sd) {
      let u1 = 1 - Math.random(); // Converting [0,1) to (0,1]
      let u2 = 1 - Math.random();
      let z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(Math.PI * 2 * u2);
      return z0 * sd + mu;
    }

    function simulateNormal(mu, sd, n) {
      const data = [];
      for (let i = 0; i < n; i++) {
        const value = normal(mu, sd);
        data.push(value);
      }
      return data;
    }

    function plotHistogram(data) {
      const layout = {
        title: "Normal Distribution",
        xaxis: {
          title: "Value",
        },
        yaxis: {
          title: "Count",
        },
      };
      const trace = {
        x: data,
        type: "histogram",
        autobinx: false,
        xbins: {
          start: Math.min(...data),
          end: Math.max(...data),
          size: 0.1,
        },
      };
      Plotly.newPlot("histogram", [trace], layout);
    }

    // Get DOM elements
    const simulateButton = document.getElementById("simulate");
    const plotButton = document.getElementById("plot");
    const muInput = document.getElementById("mu");
    const sdInput = document.getElementById("sd");
    const nInput = document.getElementById("n");
    const messageDiv = document.getElementById("message");

    // Define the simulatedData variable
    let simulatedData = [];
    // uses the let keyword to define the simulatedData outside of the event listeners, so that it can be accessed and updated by both the "Simulate" and "Plot" button event listeners. The "Simulate" button event listener now sets the simulatedData variable to the simulated data, so that it can be used later when the "Plot" button is clicked.

    // Add event listener for the "Simulate" button
    simulateButton.addEventListener("click", function () {
      const mu = parseFloat(muInput.value);
      const sd = parseFloat(sdInput.value);
      const n = parseInt(nInput.value);
      const data = simulateNormal(mu, sd, n);
      messageDiv.innerHTML = "Simulation done!";
      simulatedData = data;
    });

    // Add event listener for the "Plot" button
    plotButton.addEventListener("click", function () {
      plotHistogram(simulatedData);
    });

    </script>
  </body>
</html>
